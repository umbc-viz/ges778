<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Camille Seaberry">

<title>GES 778, Spring 2024 - 19. Project 2 troubleshooting</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../weeks/18_experiments.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../weeks/index.html">Weekly notes</a></li><li class="breadcrumb-item"><a href="../weeks/19_project2.html">19. Project 2 troubleshooting</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">GES 778, Spring 2024</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/umbc-viz/ges778.git" title="GitHub" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
    <a href="https://github.com/umbc-viz/justviz.git" title="justviz package" class="quarto-navigation-tool px-1" aria-label="justviz package"><i class="bi bi-code-slash"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Overview</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Setup</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../readings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Readings</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../decision_checklist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Decisionmaking checklist</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../weeks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Weekly notes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/00_definitions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">0. Definitions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/01_walkthrough.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Walkthrough</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/02_components.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Components of a chart</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/03_encoding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Visual encoding</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/03b_encoding_refs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3b. Encoding cheatsheets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/04_understanding_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Learning about your data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/05_good_code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. Writing good code</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/06_color.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. Color</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/07_annotations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7. Text and annotations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/08_uncertainty.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8. Uncertainty and distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/09_decisions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9. Making responsible decisions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/10_accessibility.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10. Accessibility and literacy</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/11_project1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11. Project 1 troubleshooting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/12_maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12. Spatial data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/13_data_to_space.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13. Mapping data to space</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/14_geos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">14. Manipulating geographies</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/15_color_text_mapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">15. Color, text, and annotations in mapping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/16_context.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">16. Putting spatial data in context</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/17_sad_maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">17. Avoiding sad maps</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/18_experiments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">18. Experimentation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/19_project2.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">19. Project 2 troubleshooting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Tips &amp; tricks</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tips/eda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spatial and non-spatial EDA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tips/exporting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exporting and distributing your work</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tips/fonts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fonts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tips/merging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Merging data</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References by topic</span></a>
  </div>
</li>
    </ul>
    </div>
<div class="quarto-sidebar-footer"><div class="sidebar-footer-item">
<p><a href="https://github.com/umbc-viz/ges778.git">Code for this site</a></p>
</div></div></nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#spatial-joins" id="toc-spatial-joins" class="nav-link active" data-scroll-target="#spatial-joins">Spatial joins</a></li>
  <li><a href="#lumping-factor-levels" id="toc-lumping-factor-levels" class="nav-link" data-scroll-target="#lumping-factor-levels">Lumping factor levels</a></li>
  <li><a href="#booleans-logical-values" id="toc-booleans-logical-values" class="nav-link" data-scroll-target="#booleans-logical-values">Booleans / logical values</a></li>
  <li><a href="#encoding-data-to-size" id="toc-encoding-data-to-size" class="nav-link" data-scroll-target="#encoding-data-to-size">Encoding data to size</a></li>
  <li><a href="#two-way-contingency-table-as-mosaic-plot" id="toc-two-way-contingency-table-as-mosaic-plot" class="nav-link" data-scroll-target="#two-way-contingency-table-as-mosaic-plot">Two-way contingency table as mosaic plot</a></li>
  <li><a href="#creating-a-new-spatial-variable" id="toc-creating-a-new-spatial-variable" class="nav-link" data-scroll-target="#creating-a-new-spatial-variable">Creating a new spatial variable</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/umbc-viz/ges778.git/edit/main/weeks/19_project2.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/umbc-viz/ges778.git/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/umbc-viz/ges778.git/blob/main/weeks/19_project2.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../weeks/index.html">Weekly notes</a></li><li class="breadcrumb-item"><a href="../weeks/19_project2.html">19. Project 2 troubleshooting</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">19. Project 2 troubleshooting</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Camille Seaberry </p>
          </div>
  </div>
    
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">May 11, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(justviz)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(ggmosaic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="spatial-joins" class="level2">
<h2 class="anchored" data-anchor-id="spatial-joins">Spatial joins</h2>
<p>Here’s how you can join sf points with sf polygons in order to find, for example, the number of points in each polygon. This example is brownfields per county. Like with other joins, it matters which is on the left &amp; which is on the right. <code>sf::st_join</code> has an argument to change from a left join to an inner join by setting <code>left = TRUE</code> (the default) to <code>left = FALSE</code>, respectively. The geometry after the join will follow the type of object on the left.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>counties_sf <span class="ot">&lt;-</span> tigris<span class="sc">::</span><span class="fu">counties</span>(<span class="at">state =</span> <span class="st">"24"</span>, <span class="at">cb =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="fu">select</span>(<span class="at">county =</span> NAMELSAD)</span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co"># need to get into same crs</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>brownfields_transform <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(brownfields_sf, <span class="fu">st_crs</span>(counties_sf)) <span class="sc">|&gt;</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>  <span class="co"># selecting just a subset of columns to make it easier to see what's going on</span></span>
<span id="cb2-7"><a href="#cb2-7"></a>  <span class="fu">select</span>(<span class="at">site =</span> name, is_archived)</span>
<span id="cb2-8"><a href="#cb2-8"></a></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="fu">st_join</span>(counties_sf, brownfields_transform) <span class="sc">|&gt;</span></span>
<span id="cb2-10"><a href="#cb2-10"></a>  <span class="fu">head</span>() <span class="co"># polygon join point = polygon</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 4%">
<col style="width: 14%">
<col style="width: 42%">
<col style="width: 10%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">county</th>
<th style="text-align: left;">site</th>
<th style="text-align: left;">is_archived</th>
<th style="text-align: left;">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">60</td>
<td style="text-align: left;">Baltimore County</td>
<td style="text-align: left;">Sauer Dump</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">MULTIPOLYGON (((-76.3257 39…</td>
</tr>
<tr class="even">
<td style="text-align: left;">60.1</td>
<td style="text-align: left;">Baltimore County</td>
<td style="text-align: left;">Aviation Station</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">MULTIPOLYGON (((-76.3257 39…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">60.2</td>
<td style="text-align: left;">Baltimore County</td>
<td style="text-align: left;">68th Street Dump/ East Baltimore Dumping Complex</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">MULTIPOLYGON (((-76.3257 39…</td>
</tr>
<tr class="even">
<td style="text-align: left;">60.3</td>
<td style="text-align: left;">Baltimore County</td>
<td style="text-align: left;">Industrial Enterprises</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">MULTIPOLYGON (((-76.3257 39…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">60.4</td>
<td style="text-align: left;">Baltimore County</td>
<td style="text-align: left;">Bear Creek Sediments</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">MULTIPOLYGON (((-76.3257 39…</td>
</tr>
<tr class="even">
<td style="text-align: left;">61</td>
<td style="text-align: left;">Worcester County</td>
<td style="text-align: left;">Campbell Soup Property</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: left;">MULTIPOLYGON (((-75.66061 3…</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">st_join</span>(brownfields_transform, counties_sf) <span class="sc">|&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="fu">head</span>() <span class="co"># point join polygon = point</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 44%">
<col style="width: 11%">
<col style="width: 22%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">site</th>
<th style="text-align: left;">is_archived</th>
<th style="text-align: left;">geometry</th>
<th style="text-align: left;">county</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">FNT Realty Cherry Hill</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">POINT (-76.6335 39.2574)</td>
<td style="text-align: left;">Baltimore city</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bush Valley Landfill</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">POINT (-76.2619 39.4671)</td>
<td style="text-align: left;">Harford County</td>
</tr>
<tr class="odd">
<td style="text-align: left;">101 Garrett Street</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">POINT (-76.6143 39.2376)</td>
<td style="text-align: left;">Baltimore city</td>
</tr>
<tr class="even">
<td style="text-align: left;">Northhampton, City of Largo</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: left;">POINT (-76.8279 38.8806)</td>
<td style="text-align: left;">Prince George’s County</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Shellfish Seafood, Ltd.</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">POINT (-75.688 38.2008)</td>
<td style="text-align: left;">Somerset County</td>
</tr>
<tr class="even">
<td style="text-align: left;">Former PPG - Works No.&nbsp;7 (Pittsburg Plate Glass)</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: left;">POINT (-78.7479 39.5914)</td>
<td style="text-align: left;">Allegany County</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>There are 150 rows in the brownfields data, but the first join, the dataframe with points joined onto polygons, has 153 rows. That’s because there are 3 counties with no brownfields. To deal with that, I’ll redo the join with <code>left = FALSE</code> to make it an inner join, so I don’t have any counties without brownfields.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>sites_per_county <span class="ot">&lt;-</span> <span class="fu">st_join</span>(counties_sf, brownfields_transform, <span class="at">left =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="co"># drop geometry---just want data frame for now</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>  <span class="fu">summarise</span>(<span class="at">n_total_sites =</span> <span class="fu">n</span>(),</span>
<span id="cb4-6"><a href="#cb4-6"></a>            <span class="co"># throwing in another example aggregation</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>            <span class="at">n_open_sites =</span> <span class="fu">sum</span>(<span class="sc">!</span>is_archived))</span>
<span id="cb4-8"><a href="#cb4-8"></a></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co"># join back onto counties shape, so every county has a polygon with a count</span></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co"># that makes sure we get a true 0 observation for counties without sites</span></span>
<span id="cb4-11"><a href="#cb4-11"></a>sites_per_county_sf <span class="ot">&lt;-</span> counties_sf <span class="sc">|&gt;</span></span>
<span id="cb4-12"><a href="#cb4-12"></a>  <span class="fu">left_join</span>(sites_per_county, <span class="at">by =</span> <span class="st">"county"</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-13"><a href="#cb4-13"></a>  <span class="co"># fill in 0 for counties with no observations</span></span>
<span id="cb4-14"><a href="#cb4-14"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(n_total_sites<span class="sc">:</span>n_open_sites, \(x) tidyr<span class="sc">::</span><span class="fu">replace_na</span>(x, <span class="dv">0</span>)))</span>
<span id="cb4-15"><a href="#cb4-15"></a></span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="fu">ggplot</span>(sites_per_county_sf) <span class="sc">+</span></span>
<span id="cb4-17"><a href="#cb4-17"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> n_open_sites), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb4-18"><a href="#cb4-18"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"BuPu"</span>, <span class="at">direction =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb4-19"><a href="#cb4-19"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Number of current brownfields by county"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="19_project2_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Maybe a more meaningful thing to do would be a rate, such as brownfields per 100,000 residents or brownfields per square mile, using data from the ACS dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>sites_per_county_sf <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="fu">left_join</span>(acs <span class="sc">|&gt;</span> <span class="fu">select</span>(name, total_pop, area_sqmi), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"county"</span> <span class="ot">=</span> <span class="st">"name"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="fu">mutate</span>(<span class="at">open_sites_per_100k =</span> (n_open_sites <span class="sc">/</span> total_pop) <span class="sc">*</span> <span class="dv">100000</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>    <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> open_sites_per_100k), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>    <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"BuPu"</span>, <span class="at">direction =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Current brownfields per 100k residents by county"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="19_project2_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If instead we were interested in the points themselves but wanted to know what counties they were each in, a join with brownfields on the left would be helpful. For this example it wouldn’t be super useful, but for other project ideas (such as finding points within buffers) it could be.</p>
</section>
<section id="lumping-factor-levels" class="level2">
<h2 class="anchored" data-anchor-id="lumping-factor-levels">Lumping factor levels</h2>
<p>If you have a variable with several values you want to collapse into one, the easiest way to do this is to make it a factor if it isn’t already, then use one of <code>forcats</code>’ helper functions.</p>
<p>With a character column, we can use <code>fct_other</code> or the various <code>fct_lump_*</code> functions to select which levels to keep; everything else gets dumped into the “other” category. The advantage of doing this with factors (as opposed to character vectors) is that factor levels have an order, and these functions will automatically put the “order” level last. Here are a few of those functions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># way more medium values than would be useful</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>art_types <span class="ot">&lt;-</span> art_sf <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(medium))</span>
<span id="cb6-5"><a href="#cb6-5"></a></span>
<span id="cb6-6"><a href="#cb6-6"></a>art_types <span class="sc">|&gt;</span></span>
<span id="cb6-7"><a href="#cb6-7"></a>  <span class="fu">count</span>(medium, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>  <span class="fu">mutate</span>(<span class="at">share =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">medium</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">share</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">mural</td>
<td style="text-align: right;">147</td>
<td style="text-align: right;">0.2639138</td>
</tr>
<tr class="even">
<td style="text-align: left;">bronze</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">0.1490126</td>
</tr>
<tr class="odd">
<td style="text-align: left;">painted steel</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">0.0323160</td>
</tr>
<tr class="even">
<td style="text-align: left;">steel</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">0.0305206</td>
</tr>
<tr class="odd">
<td style="text-align: left;">concrete</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0.0251346</td>
</tr>
<tr class="even">
<td style="text-align: left;">aluminum</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0.0197487</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mural (non-city funded)</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0.0197487</td>
</tr>
<tr class="even">
<td style="text-align: left;">sculpture</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0.0197487</td>
</tr>
<tr class="odd">
<td style="text-align: left;">marble</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0.0179533</td>
</tr>
<tr class="even">
<td style="text-align: left;">ceramic tiles</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0.0161580</td>
</tr>
<tr class="odd">
<td style="text-align: left;">limestone</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0.0161580</td>
</tr>
<tr class="even">
<td style="text-align: left;">stainless steel</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0.0161580</td>
</tr>
<tr class="odd">
<td style="text-align: left;">weathering steel</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0.0143627</td>
</tr>
<tr class="even">
<td style="text-align: left;">corten steel</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.0125673</td>
</tr>
<tr class="odd">
<td style="text-align: left;">oil/canvas</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.0089767</td>
</tr>
<tr class="even">
<td style="text-align: left;">stained glass</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.0089767</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ceramic tile</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.0071813</td>
</tr>
<tr class="even">
<td style="text-align: left;">cor ten</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.0071813</td>
</tr>
<tr class="odd">
<td style="text-align: left;">fabric wall hanging</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.0071813</td>
</tr>
<tr class="even">
<td style="text-align: left;">fiber</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.0071813</td>
</tr>
<tr class="odd">
<td style="text-align: left;">granite</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.0071813</td>
</tr>
<tr class="even">
<td style="text-align: left;">acrylic</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.0053860</td>
</tr>
<tr class="odd">
<td style="text-align: left;">acrylic, wood</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.0053860</td>
</tr>
<tr class="even">
<td style="text-align: left;">painted aluminum</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.0053860</td>
</tr>
<tr class="odd">
<td style="text-align: left;">polyester resin</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.0053860</td>
</tr>
<tr class="even">
<td style="text-align: left;">acrylic paint</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.0035907</td>
</tr>
<tr class="odd">
<td style="text-align: left;">acrylic windows</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.0035907</td>
</tr>
<tr class="even">
<td style="text-align: left;">brick</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.0035907</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ceramics</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.0035907</td>
</tr>
<tr class="even">
<td style="text-align: left;">chrome</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.0035907</td>
</tr>
<tr class="odd">
<td style="text-align: left;">copper</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.0035907</td>
</tr>
<tr class="even">
<td style="text-align: left;">corten</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.0035907</td>
</tr>
<tr class="odd">
<td style="text-align: left;">epoxy resin</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.0035907</td>
</tr>
<tr class="even">
<td style="text-align: left;">fiberglass, stainless ste</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.0035907</td>
</tr>
<tr class="odd">
<td style="text-align: left;">metal</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.0035907</td>
</tr>
<tr class="even">
<td style="text-align: left;">metal sculpture</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.0035907</td>
</tr>
<tr class="odd">
<td style="text-align: left;">metal wall sculpture</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.0035907</td>
</tr>
<tr class="even">
<td style="text-align: left;">mixed media</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.0035907</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mosaic tile</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.0035907</td>
</tr>
<tr class="even">
<td style="text-align: left;">neon</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.0035907</td>
</tr>
<tr class="odd">
<td style="text-align: left;">stone aggregate</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.0035907</td>
</tr>
<tr class="even">
<td style="text-align: left;">terra cotta</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.0035907</td>
</tr>
<tr class="odd">
<td style="text-align: left;">acrylic on canvas</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">acrylic window</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">aggregate stone</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">aluminum and bronze</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">aluminum plate</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">aluminum relief</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">aluminum wall relief</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">aluminum, corten, stainle</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">aluminum, plexiglas, mirr</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">bas relief</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">black tennensee marble</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">brass</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">brick and concrete</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">brick sculptured wall</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">brick wall hanging</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">bridge repainting</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bronze &amp; marble</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">bronze and granite</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bronze and unpolished granite</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">bronze and welded copper</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bronze bust, stainless steel pedestal</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">bronze coated steel</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bronze1992/orig.cast iron</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">burnished aluminum</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bus shelters</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">cast aluminum</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cast granite</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">cast iron</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cast stone</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">cement</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ceramic bas relief</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">ceramic tree</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">clay</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">collage</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">concrete aggregate</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">concrete and corten steel</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">concrete and glass</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">concrete and rubber</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">concrete with ceramic til</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">concrete, aluminum, steel</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">concrete, steel, aluminum</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">concrete/ stone</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">copper and stainless steel</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">cor-ten &amp; stainless steel</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">corten &amp; steel</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">corten steel and aluminum</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">etched glass</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">exposed aggregate</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">fiberglass</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">fiberglass &amp; clock</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">forged steel</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">formica frames</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">free-standing sculpture</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">galvanized playground str</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">glass-reinforced polyester resin</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">granite &amp; steel</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">granite and aluminum?</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">gunite</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">iron</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">limestone and cedar</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">limestone/stainless steel</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">mayari r steel</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">memorial</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">metal (bronze?)</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">metalic sculpture</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">mosaic</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mosaic tile/concrete sculpture</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">mosaic tiles</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">oil on canvas</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">oil on canvas, framed</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">oil/masonite</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">painted corten plate steel</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">painted metal</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">painted mural</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">painted steel tubing</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">painting</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">photographic display case</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">photographic emulsion</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">photographic mural</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">photographic relief piece</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">plaques</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">polished steel</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">porcelain enameling iron</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">portrait</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">print, wood</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">quarry tile floor</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">restoration of paintings</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">sandstone</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sculptural garden</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">sculptural panel and mura</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sculpture - neon, aluminum &amp; resin</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">sculpture, painted steel</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sculptured display cases</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">sheet bronze doors</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">slate &amp; cor ten</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">stained glass mobile</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">stainglass</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">stainless steel / aluminum?</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">stainless steel and alumi</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">stainless steel and bronz</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">steel &amp; steel cable</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">steel and aluminum</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">steel and corten</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">steel, aluminum, cable,castconcrete</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">steel, forged iron, wood</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">stone</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">stone (or terracotta)</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">tactile relief mural</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tennenese limestine</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">terra-cotta</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tiles</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">urns</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">wall hangings</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">welded metal sculpture</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">welded metal wall sculptu</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="even">
<td style="text-align: left;">wood</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">wood relief</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0017953</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Only keep 3 most common levels:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>art_types <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="fu">mutate</span>(<span class="at">medium_grps =</span> forcats<span class="sc">::</span><span class="fu">fct_lump_n</span>(medium, </span>
<span id="cb7-3"><a href="#cb7-3"></a>                                           <span class="at">n =</span> <span class="dv">3</span>, </span>
<span id="cb7-4"><a href="#cb7-4"></a>                                           <span class="at">other_level =</span> <span class="st">"other types"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>  <span class="fu">count</span>(medium_grps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">medium_grps</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">bronze</td>
<td style="text-align: right;">83</td>
</tr>
<tr class="even">
<td style="text-align: left;">mural</td>
<td style="text-align: right;">147</td>
</tr>
<tr class="odd">
<td style="text-align: left;">painted steel</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="even">
<td style="text-align: left;">other types</td>
<td style="text-align: right;">309</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Only keep levels with at least 12 observations:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>art_types <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="fu">mutate</span>(<span class="at">medium_grps =</span> forcats<span class="sc">::</span><span class="fu">fct_lump_min</span>(medium, </span>
<span id="cb8-3"><a href="#cb8-3"></a>                                           <span class="at">min =</span> <span class="dv">12</span>, </span>
<span id="cb8-4"><a href="#cb8-4"></a>                                           <span class="at">other_level =</span> <span class="st">"other types"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="fu">count</span>(medium_grps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">medium_grps</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">bronze</td>
<td style="text-align: right;">83</td>
</tr>
<tr class="even">
<td style="text-align: left;">concrete</td>
<td style="text-align: right;">14</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mural</td>
<td style="text-align: right;">147</td>
</tr>
<tr class="even">
<td style="text-align: left;">painted steel</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="odd">
<td style="text-align: left;">steel</td>
<td style="text-align: right;">17</td>
</tr>
<tr class="even">
<td style="text-align: left;">other types</td>
<td style="text-align: right;">278</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Only keep levels I’ve specifically chosen (let’s say I’m interested in a few sculpture types):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>art_types <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="fu">mutate</span>(<span class="at">medium_grps =</span> forcats<span class="sc">::</span><span class="fu">fct_other</span>(medium, </span>
<span id="cb9-3"><a href="#cb9-3"></a>                                          <span class="at">keep =</span> <span class="fu">c</span>(<span class="st">"concrete"</span>, <span class="st">"marble"</span>, <span class="st">"limestone"</span>, <span class="st">"granite"</span>),</span>
<span id="cb9-4"><a href="#cb9-4"></a>                                          <span class="at">other_level =</span> <span class="st">"other types"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>  <span class="fu">count</span>(medium_grps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">medium_grps</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">concrete</td>
<td style="text-align: right;">14</td>
</tr>
<tr class="even">
<td style="text-align: left;">granite</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">limestone</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">marble</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">other types</td>
<td style="text-align: right;">520</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># rstudio started warning that you need the drop argument also; that's a lie</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="booleans-logical-values" class="level2">
<h2 class="anchored" data-anchor-id="booleans-logical-values">Booleans / logical values</h2>
<p>Going back over the bit of boolean math we talked about: logical values (true / false) can translate in most (all?) languages to numeric values (1 / 0). That gives you some shortcuts when you need to aggregate data based on logical values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>x_logic <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span>
<span id="cb11-2"><a href="#cb11-2"></a></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="co"># count of true values</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="fu">sum</span>(x_logic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># count of false values</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="fu">sum</span>(<span class="sc">!</span>x_logic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># share of values that are true</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="fu">mean</span>(x_logic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6</code></pre>
</div>
</div>
</section>
<section id="encoding-data-to-size" class="level2">
<h2 class="anchored" data-anchor-id="encoding-data-to-size">Encoding data to size</h2>
<p>If you map data onto the size of a point, encode that information in the point’s <em>area</em>, not its <em>radius</em>. Perception studies show that area is what we’re reading more than radius, and you want your data to have a 1 to 1 relationship with the thing you’re encoding to (data-to-ink ratio). The default in ggplot is radius, but you can override that with <code>scale_size_area</code>. Normally, size scales (e.g.&nbsp;<code>scale_size_continuous</code>) would have an argument <code>range</code> for the smallest and largest values to use; for area, you give <code>max_size</code> as a single number. If you have a 0 in your data, it will have an area of 0, unlike when using the continuous scale.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>x_area <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">location =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, </span>
<span id="cb17-2"><a href="#cb17-2"></a>                     <span class="at">value =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">5</span>))</span>
<span id="cb17-3"><a href="#cb17-3"></a></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="co"># why would a value of 0 have a point?? We wouldn't draw a bar in a bar chart</span></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="co"># for a 0 value</span></span>
<span id="cb17-6"><a href="#cb17-6"></a><span class="fu">ggplot</span>(x_area, <span class="fu">aes</span>(<span class="at">x =</span> location, <span class="at">y =</span> <span class="dv">1</span>, <span class="at">size =</span> value)) <span class="sc">+</span></span>
<span id="cb17-7"><a href="#cb17-7"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="19_project2_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># still kinda has a dot for 0 but that might be a graphic device artifact..?</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="fu">ggplot</span>(x_area, <span class="fu">aes</span>(<span class="at">x =</span> location, <span class="at">y =</span> <span class="dv">1</span>, <span class="at">size =</span> value)) <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4"></a>  <span class="fu">scale_size_area</span>(<span class="at">max_size =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="19_project2_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="two-way-contingency-table-as-mosaic-plot" class="level2">
<h2 class="anchored" data-anchor-id="two-way-contingency-table-as-mosaic-plot">Two-way contingency table as mosaic plot</h2>
<p>Two true/false variables (or other qualitative variables) can be shown as a contingency table with a mosaic plot. Adding facets gives you the option of more than two dimensions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>current_brownfields <span class="ot">&lt;-</span> brownfields_sf <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3"></a>  <span class="fu">filter</span>(<span class="sc">!</span>is_archived) <span class="sc">|&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4"></a>  <span class="fu">count</span>(is_ongoing_assess, is_ongoing_remed)</span>
<span id="cb19-5"><a href="#cb19-5"></a></span>
<span id="cb19-6"><a href="#cb19-6"></a><span class="co"># number of sites currently being assessed, remediated, neither, both</span></span>
<span id="cb19-7"><a href="#cb19-7"></a>current_brownfields</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">is_ongoing_assess</th>
<th style="text-align: left;">is_ongoing_remed</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">101</td>
</tr>
<tr class="even">
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TRUE</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">TRUE</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu">ggplot</span>(current_brownfields) <span class="sc">+</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>  <span class="fu">geom_mosaic</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">product</span>(is_ongoing_assess), <span class="at">fill =</span> is_ongoing_remed, <span class="at">weight =</span> n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="19_project2_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="creating-a-new-spatial-variable" class="level2">
<h2 class="anchored" data-anchor-id="creating-a-new-spatial-variable">Creating a new spatial variable</h2>
<p>For things that are related to distance, such as accessibility (e.g.&nbsp;bus stops) or hazards (e.g.&nbsp;brownfields) if can be useful to create a variable flagging whether a location is within some certain distance of a target. You can do this with spatial overlays. The locations you use as your unit of analysis don’t have to be points that may be within some buffer of the target; they could also be an area like census tracts.</p>
<p>Here’s a local superfund site (the Sauer dump in Baltimore County) with a 2 mile radius around it. We can create a dummy variable denoting whether locations are in that buffer, join the buffer to our unit of analysis (tracts), then use that flag as a way to split up the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>dump_buffer <span class="ot">&lt;-</span> brownfields_sf <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">"Sauer Dump"</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="dv">2248</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-4"><a href="#cb21-4"></a>  sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="at">dist =</span> <span class="dv">2</span> <span class="sc">*</span> <span class="dv">5280</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-5"><a href="#cb21-5"></a>  <span class="fu">select</span>(geometry) <span class="sc">|&gt;</span></span>
<span id="cb21-6"><a href="#cb21-6"></a>  <span class="co"># dummy variable to show that tracts are within the buffer</span></span>
<span id="cb21-7"><a href="#cb21-7"></a>  <span class="fu">mutate</span>(<span class="at">is_near_sauer =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are a couple ways to join spatial data—<code>st_join</code> will join data from the sf object y onto the sf object x; this can be a left join (<code>left = TRUE</code>, the default) or an inner join (<code>left = FALSE</code>). The geometry of x stays the same.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># baltimore-area tracts</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>balt_tracts <span class="ot">&lt;-</span> tracts_sf <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3"></a>  <span class="co"># need same crs</span></span>
<span id="cb22-4"><a href="#cb22-4"></a>  <span class="fu">st_transform</span>(<span class="dv">2248</span>)</span>
<span id="cb22-5"><a href="#cb22-5"></a></span>
<span id="cb22-6"><a href="#cb22-6"></a><span class="co"># left join keeps all tracts</span></span>
<span id="cb22-7"><a href="#cb22-7"></a><span class="fu">st_join</span>(balt_tracts, dump_buffer, <span class="at">left =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-8"><a href="#cb22-8"></a>  <span class="fu">select</span>(is_near_sauer) <span class="sc">|&gt;</span></span>
<span id="cb22-9"><a href="#cb22-9"></a>  <span class="fu">plot</span>(<span class="at">main =</span> <span class="st">"left join"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="19_project2_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># inner join keeps only tracts in buffer</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="fu">st_join</span>(balt_tracts, dump_buffer, <span class="at">left =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-3"><a href="#cb23-3"></a>  <span class="fu">select</span>(is_near_sauer) <span class="sc">|&gt;</span></span>
<span id="cb23-4"><a href="#cb23-4"></a>  <span class="fu">plot</span>(<span class="at">main =</span> <span class="st">"inner join"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="19_project2_files/figure-html/unnamed-chunk-13-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Calculating the intersection of geometries instead (<code>st_intersection</code>) changes the geometry of x based on how it intersects with y.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="fu">st_intersection</span>(balt_tracts, dump_buffer) <span class="sc">|&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>  <span class="fu">select</span>(is_near_sauer) <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3"></a>  <span class="fu">plot</span>(<span class="at">main =</span> <span class="st">"intersection"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="19_project2_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>To make a variable that allows us to compare some data for tracts within the buffer versus those outside the buffer, we want the spatial left join. For the <code>NA</code>s that result from the join, fill in FALSE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>dump_tracts <span class="ot">&lt;-</span> <span class="fu">st_join</span>(balt_tracts, dump_buffer, <span class="at">left =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>  <span class="fu">mutate</span>(<span class="at">is_near_sauer =</span> tidyr<span class="sc">::</span><span class="fu">replace_na</span>(is_near_sauer, <span class="at">replace =</span> <span class="cn">FALSE</span>))</span>
<span id="cb25-3"><a href="#cb25-3"></a></span>
<span id="cb25-4"><a href="#cb25-4"></a>dump_tracts <span class="sc">|&gt;</span></span>
<span id="cb25-5"><a href="#cb25-5"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb25-6"><a href="#cb25-6"></a>  <span class="fu">count</span>(is_near_sauer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">is_near_sauer</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">588</td>
</tr>
<tr class="even">
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">18</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>dump_tracts <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>  <span class="fu">left_join</span>(ej_natl, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"geoid"</span> <span class="ot">=</span> <span class="st">"tract"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="fu">filter</span>(indicator <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"diesel"</span>, <span class="st">"releases_to_air"</span>, <span class="st">"risk_mgmt_plan"</span>, <span class="st">"wastewater"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb26-4"><a href="#cb26-4"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> indicator, <span class="at">y =</span> value_ptile, <span class="at">color =</span> is_near_sauer)) <span class="sc">+</span></span>
<span id="cb26-5"><a href="#cb26-5"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="19_project2_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Because these two groups are so skewed (only 18 tracts in the buffer), another chart that shows the distributions but also gives some sense of the group size might be more appropriate (beeswarm, density). You could do something similar with more than one buffer around more than one site, such as ACS variables split by whether a tract is within 2 miles of a superfund (NPL) site.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>all_tracts_sf <span class="ot">&lt;-</span> tigris<span class="sc">::</span><span class="fu">tracts</span>(<span class="at">state =</span> <span class="st">"24"</span>, <span class="at">cb =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>  <span class="fu">select</span>(<span class="at">geoid =</span> GEOID) <span class="sc">|&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3"></a>  <span class="fu">st_transform</span>(<span class="dv">2248</span>)</span>
<span id="cb27-4"><a href="#cb27-4"></a></span>
<span id="cb27-5"><a href="#cb27-5"></a>npl_buffer <span class="ot">&lt;-</span> brownfields_sf <span class="sc">|&gt;</span></span>
<span id="cb27-6"><a href="#cb27-6"></a>  <span class="fu">filter</span>(<span class="sc">!</span>is_archived,</span>
<span id="cb27-7"><a href="#cb27-7"></a>         site_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"npl"</span>, <span class="st">"both"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb27-8"><a href="#cb27-8"></a>  <span class="fu">st_transform</span>(<span class="dv">2248</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-9"><a href="#cb27-9"></a>  <span class="fu">st_buffer</span>(<span class="at">dist =</span> <span class="dv">2</span> <span class="sc">*</span> <span class="dv">5280</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-10"><a href="#cb27-10"></a>  <span class="fu">mutate</span>(<span class="at">is_near_npl =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-11"><a href="#cb27-11"></a>  <span class="fu">group_by</span>(is_near_npl) <span class="sc">|&gt;</span></span>
<span id="cb27-12"><a href="#cb27-12"></a>  <span class="fu">summarise</span>()</span>
<span id="cb27-13"><a href="#cb27-13"></a></span>
<span id="cb27-14"><a href="#cb27-14"></a>acs_x_npl <span class="ot">&lt;-</span> all_tracts_sf <span class="sc">|&gt;</span></span>
<span id="cb27-15"><a href="#cb27-15"></a>  <span class="fu">st_join</span>(npl_buffer, <span class="at">left =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-16"><a href="#cb27-16"></a>  <span class="fu">mutate</span>(<span class="at">is_near_npl =</span> tidyr<span class="sc">::</span><span class="fu">replace_na</span>(is_near_npl, <span class="cn">FALSE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb27-17"><a href="#cb27-17"></a>  <span class="fu">left_join</span>(acs, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"geoid"</span> <span class="ot">=</span> <span class="st">"name"</span>))</span>
<span id="cb27-18"><a href="#cb27-18"></a></span>
<span id="cb27-19"><a href="#cb27-19"></a>acs_x_npl <span class="sc">|&gt;</span></span>
<span id="cb27-20"><a href="#cb27-20"></a>  <span class="fu">select</span>(geoid, is_near_npl, white, poverty, less_than_high_school, homeownership, foreign_born) <span class="sc">|&gt;</span></span>
<span id="cb27-21"><a href="#cb27-21"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb27-22"><a href="#cb27-22"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="sc">-</span>geoid<span class="sc">:-</span>is_near_npl, <span class="at">names_to =</span> <span class="st">"variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-23"><a href="#cb27-23"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> variable, <span class="at">y =</span> value, <span class="at">color =</span> is_near_npl)) <span class="sc">+</span></span>
<span id="cb27-24"><a href="#cb27-24"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="19_project2_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../weeks/18_experiments.html" class="pagination-link  aria-label=" 18.="" experimentation"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">18. Experimentation</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/umbc-viz/ges778.git/edit/main/weeks/19_project2.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/umbc-viz/ges778.git/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/umbc-viz/ges778.git/blob/main/weeks/19_project2.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></div></div></footer></body></html>